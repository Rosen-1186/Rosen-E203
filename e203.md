# E203摸鱼日志

### 26/2/21
**当日事项**：
    1.配置完毕 e203_hbirdv2 仓库与 hbird_sdk（位于e203_hbirdv2/software目录内）;
    2.构建并运行 coremark 基准测试（ITER=1），获取基本性能水平；
    3.创建 github repo 并 push 到远程仓库。

**基本性能水平（运行时钟540999Hz，测试迭代20次）**：2.153600 CoreMark/MHz

**踩坑**：E203 架构的 ITCM 基地址为 0x80000000 ，用 DOWNLOAD=ilm 编译时无报错，但无法正常仿真（出现取指令死锁）。
**问题分析**：Verilog 的 Testbench 内用于模拟 ITCM 的数组长度可能过短，导致仿真器启动时出现越界报错，导致 ITCM 数组无法正常读取。
**解决方法**：在将 coremark.elf 转换成 coremark.verilog 时用 objcopy 平移机器码地址到 0x00000000 。
**使用指令**：
```bash
riscv64-unknown-elf-objcopy -O verilog --adjust-vma=-0x80000000 *filename*.elf *filename*.verilog
```
**次日安排**：
    1.审查 e203 的 Verilog RTL 仓库目录，搞懂顶层架构；
    2.基于 my_hello 创建波形测试架，基于 GTKWave 看波形变化，分析端口行为。

### 26/2/22
**当日事项**：摸鱼。

### 26/2/23
**当日事项**：收拾。

### 26/2/24
**当日事项**：赶路。

### 26/2/25
**当日事项**：赶路。

### 26/2/26
**当日事项**：聚。

### 26/2/27
**当日事项**：摸鱼。

### 26/2/28
**当日事项**：
    1.基于 GTKWave 查看并分析仿真波形，分析编译器和处理器在处理程序与机器码时的特性。

**踩坑 1**：
    在编译运行移位器的c代码时，为了查看波形搜索了机器码。手算的 32 位移位机器码是 00209093，然而 GTKWave 内检查时在 ifu_o_ir 检查时并未检出预期机器码。
**问题分析 1**：
    触发了 RISC-V 的 C 压缩指令集特性，将32位机器码 00209093 压缩为一个 16 位指令：008a。
**解决方法 1**：
    使用 objdump 反编译 .elf 文件得到 .dump 文件后查找有关主函数机器码，分析其与32位标准机器码的不同。
```dump
    800000b4 <main>:
    800000b4:	00100093          	li	ra,1
    800000b8:	008a                	slli	ra,ra,0x2
    800000ba:	9002                	ebreak
    800000bc:	4501                	li	a0,0
    800000be:	8082                	ret
```
**使用指令 1**：
```bash
riscv64-unknown-elf-objdump -d my_hello.elf > my_hello.dump
```

### 26/3/1
**当日事项**：摸鱼。

### 26/3/2
**当日事项**：
